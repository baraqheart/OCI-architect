### **Study Notes: OCI Dynamic Routing Gateway (DRG) - Part 1**

---

#### **1. What is a Dynamic Routing Gateway (DRG)?**

A **Dynamic Routing Gateway (DRG)** is a **virtual router** that provides sophisticated routing capabilities for connecting your VCN to external networks.

*   **Function:** Acts as a **central routing hub** for multiple network attachments
*   **Purpose:** Enables complex routing scenarios and hybrid connectivity
*   **Scope:** Regional resource that can connect to various network types

---

#### **2. DRG Attachment Types**

A DRG can connect to **five types of network attachments**:

##### **A. VCN Attachments:**
*   Connects to **Virtual Cloud Networks** within the same region
*   Enables VCN-to-VCN routing via DRG

##### **B. Remote Peering Connections (RPC):**
*   Enables **cross-region VCN peering**
*   Connects to DRGs in other OCI regions

##### **C. IPsec Tunnel Attachments:**
*   Part of **Site-to-Site VPN** connections
*   Provides encrypted connectivity over internet

##### **D. Virtual Circuit Attachments:**
*   Part of **FastConnect** dedicated connections
*   Provides high-speed private connectivity

##### **E. Loopback Attachments:**
*   **Internal DRG routing** between different attachment types
*   **Use Case:** Forward traffic from virtual circuit to IPsec tunnel within same DRG

---

#### **3. DRG Routing Components**

DRG routing is managed through **two key entities**:

##### **A. DRG Route Tables:**
*   Control how traffic is routed **between DRG attachments**
*   **Two auto-created tables** when DRG is provisioned

##### **B. DRG Route Distribution:**
*   Controls how routes are **imported and exported** between attachments
*   **Three auto-created distributions** when DRG is provisioned

---

#### **4. Auto-Generated DRG Route Tables**

When you create a DRG, **two route tables are automatically created**:

##### **A. Route Table 1: For RPC, Virtual Circuit, and IPSec Attachments**
*   **Full Name:** "Autogenerated DRG route table for RPC, virtual circuit, and IPsec attachments"
*   **Purpose:** Routes traffic between these specific attachment types

##### **B. Route Table 2: For VCN Attachments**
*   **Full Name:** "Autogenerated DRG route table for VCN attachments"
*   **Purpose:** Routes traffic involving VCN attachments

---

#### **5. Auto-Generated DRG Route Distributions**

When you create a DRG, **three route distributions are automatically created**:

##### **A. Import Route Distributions (2 created):**
1.  **Import Route Distribution for VCN Routes**
2.  **Import Route Distribution for All Routes**

##### **B. Export Route Distribution (1 created):**
1.  **Default Export Route Distribution for DRG**

---

#### **6. DRG Route Table and Distribution Relationships**

##### **A. Route Table 1 (RPC/VC/IPSec) Configuration:**
*   **Uses:** Import Route Distribution for **VCN Routes**
*   **Result:** Only imports routes from **VCN attachments**
*   **Example:** Contains dynamic route for VCN CIDR only

##### **B. Route Table 2 (VCN Attachments) Configuration:**
*   **Uses:** Import Route Distribution for **All Routes**
*   **Result:** Imports routes from **all attachment types**
*   **Example:** Contains routes for VCN + Remote Peering Connection

---

#### **7. Practical Routing Example**

**Scenario:** DRG with VCN Attachment and Remote Peering Connection

```
DRG Components:
├── Route Table 1 (RPC/VC/IPSec):
│   └── Importing: VCN Routes only
│       └── Dynamic Route: VCN CIDR (10.0.0.0/16)
├── Route Table 2 (VCN Attachments):
│   └── Importing: All Routes
│       ├── Dynamic Route: VCN CIDR (10.0.0.0/16)
│       └── Dynamic Route: Remote Peering CIDR (192.168.0.0/16)
└── Attachments:
    ├── VCN Attachment (10.0.0.0/16)
    └── RPC Attachment (192.168.0.0/16)
```

**Routing Result:**
*   **Route Table 1:** Can route to VCN (10.0.0.0/16) only
*   **Route Table 2:** Can route to both VCN (10.0.0.0/16) and RPC (192.168.0.0/16)

---

#### **8. Key DRG Routing Concepts**

##### **A. Import Route Distribution:**
*   Controls **which routes are imported INTO** a DRG route table
*   **Source:** Routes learned from various attachments
*   **Destination:** DRG route tables

##### **B. Export Route Distribution:**
*   Controls **which routes are exported FROM** the DRG
*   **Source:** DRG route tables
*   **Destination:** External networks through attachments

##### **C. Dynamic Route Learning:**
*   Routes are **automatically learned** through BGP sessions
*   **No manual configuration** required for dynamic routes
*   **Automatic updates** when network topology changes

---

#### **Key DRG Architecture Principles**

*   **Hub-and-Spoke Model:** DRG acts as central hub for multiple network connections
*   **Policy-Based Routing:** Fine-grained control over traffic flow between attachments
*   **Automatic Provisioning:** Critical routing components created automatically
*   **Scalable Design:** Supports complex enterprise networking scenarios
*   **Hybrid Ready:** Connects cloud VCNs with on-premises networks seamlessly

### **Study Notes: OCI Dynamic Routing Gateway (DRG) - Part 2**

---

#### **1. DRG Routing Fundamentals**

The **Dynamic Routing Gateway (DRG)** uses **route tables and route distributions** to control traffic flow between different network attachments.

*   **Primary Function:** Routes traffic **between DRG attachments**
*   **Control Mechanism:** DRG Route Tables + DRG Route Distributions
*   **Policy Enforcement:** Defines how traffic is handled when entering the DRG

---

#### **2. DRG Attachment Types Recap**

A DRG can connect to **five types of attachments**:

*   **VCN Attachments:** Virtual Cloud Network connections
*   **IPSec Attachments:** Site-to-Site VPN tunnels
*   **Virtual Circuit Attachments:** FastConnect dedicated connections
*   **Remote Peering Connections (RPC):** Cross-region VCN peering
*   **Loopback Attachments:** Internal routing between attachment types

---

#### **3. Route Types in DRG**

##### **A. Static Routes:**
*   **Creation:** **Manually configured** by administrators
*   **Management:** Requires manual updates for network changes
*   **Use Case:** Specific, predictable routing requirements

##### **B. Dynamic Routes:**
*   **Creation:** **Automatically imported** via import route distributions
*   **Management:** **Self-updating** based on network topology changes
*   **Source:** Learned through BGP sessions with external networks
*   **Use Case:** Dynamic network environments, hybrid connectivity

---

#### **4. DRG Route Table Assignment**

##### **A. Attachment-Route Table Relationship:**
*   **Each DRG attachment** has an **associated DRG route table**
*   **Purpose:** Determines **next hop** for packets entering DRG through that attachment

##### **B. Route Table Assignment Options:**
*   **Dedicated Route Tables:** One route table per attachment (granular control)
*   **Shared Route Tables:** Same route table for multiple attachments (simplified management)
*   **Default Configuration:** Two auto-created tables:
    *   One for **VCN attachments**
    *   One for **all other attachment types**

---

#### **5. Packet Routing Flow in DRG**

##### **Packet Entry Scenario:**
```
Packet enters DRG → VCN Attachment → Associated DRG Route Table → Next Hop Decision
```

##### **Routing Decision Process:**
1.  **Packet arrives** at DRG through specific attachment
2.  **DRG consults** the route table assigned to that attachment
3.  **Route table determines** the next hop based on destination
4.  **Packet is forwarded** to appropriate outgoing attachment

---

#### **6. Critical Distinction: VCN Route Table vs DRG Route Table**

##### **A. VCN Route Table:**
*   **Scope:** Controls routing **within the VCN**
*   **Function:** Determines how packets are routed **inside VCN**
*   **Packet Entry:** When packets **enter VCN** through attachments
*   **Example Decision:** "Should this packet go to Internet Gateway, NAT Gateway, or DRG?"

##### **B. DRG Route Table:**
*   **Scope:** Controls routing **within the DRG**
*   **Function:** Determines how packets are routed **between DRG attachments**
*   **Packet Entry:** When packets **enter DRG** through attachments
*   **Example Decision:** "Should this packet go to VPN, FastConnect, or another VCN?"

---

#### **7. Complete Routing Architecture**

```
VCN Environment:                    DRG Environment:
├── VCN Route Table                 ├── DRG Route Table (for VCN attachment)
│   └── Controls internal VCN       │   └── Controls DRG routing for VCN traffic
│       routing decisions           │
└── VCN Attachment →                └── Processes packets entering DRG
    (entry point to DRG)                from VCN attachment
```

**Traffic Flow Example:**
```
VCN Instance (10.0.1.10) → VCN Route Table → VCN Attachment → 
DRG Route Table → Remote Peering Connection → Peer VCN
```

---

#### **8. Practical Configuration Scenarios**

##### **Scenario A: Default Configuration**
```
DRG with Default Setup:
├── VCN Attachment → DRG Route Table for VCN Attachments
├── VPN Attachment → DRG Route Table for RPC/VC/IPSec
└── RPC Attachment → DRG Route Table for RPC/VC/IPSec
```

##### **Scenario B: Custom Configuration**
```
DRG with Custom Setup:
├── VCN-Prod Attachment → Prod-DRG-Route-Table
├── VCN-Dev Attachment → Dev-DRG-Route-Table  
├── VPN Attachment → Internet-DRG-Route-Table
└── FastConnect Attachment → Corporate-DRG-Route-Table
```

---

#### **9. Route Table Assignment Strategies**

##### **A. Environment-Based Assignment:**
*   **Production VCNs** → Production DRG Route Table
*   **Development VCNs** → Development DRG Route Table
*   **Testing VCNs** → Testing DRG Route Table

##### **B. Traffic Type-Based Assignment:**
*   **Internet-bound traffic** → Internet DRG Route Table
*   **Corporate network traffic** → Corporate DRG Route Table
*   **Partner network traffic** → Partner DRG Route Table

##### **C. Security Zone-Based Assignment:**
*   **DMZ VCNs** → DMZ DRG Route Table
*   **Internal VCNs** → Internal DRG Route Table
*   **Sensitive VCNs** → Restricted DRG Route Table

---

#### **Key DRG Routing Principles**

*   **Separation of Concerns:** VCN route tables handle internal routing, DRG route tables handle external routing
*   **Attachment-Centric:** Each attachment's traffic is governed by its assigned DRG route table
*   **Flexible Assignment:** Mix and match route tables to attachments based on requirements
*   **Dynamic Learning:** BGP-enabled attachments automatically propagate route changes
*   **Policy Enforcement:** DRG route tables enforce organizational routing policies

### **Study Notes: OCI Dynamic Routing Gateway (DRG) - Part 3**

---

#### **1. Dynamic Route Import Distribution**

**Dynamic Route Import Distribution** controls how route advertisements from DRG attachments are inserted into DRG route tables.

*   **Function:** Manages **incoming route advertisements** from attachments
*   **Mechanism:** Uses **statements with match criteria** to filter routes
*   **Priority System:** Statements with **lower numbers have higher priority**

##### **Import Distribution Flow:**
```
Route Advertisements → Import Distribution → Match Criteria → DRG Route Table
```

**Example Import Statement:**
```
Statement 5: Match ALL traffic → Import ALL routes into DRG route table
```

---

#### **2. Dynamic Route Export Distribution**

**Dynamic Route Export Distribution** controls how routes are advertised from DRG route tables to attachments.

*   **Function:** Manages **outgoing route advertisements** to attachments
*   **Direction:** Reverse of import distribution
*   **Default:** One export distribution created automatically with DRG

##### **Export Distribution Flow:**
```
DRG Route Table → Export Distribution → Route Advertisements → Attachments
```

##### **Export Restrictions:**
*   **IPSec/Virtual Circuit Isolation:** Routes from one IPSec tunnel **cannot be exported** to other IPSec tunnels or virtual circuits
*   **Security Measure:** Prevents unintended route propagation between external connections

---

#### **3. Equal Cost Multi-Path Routing (ECMP)**

**ECMP** enables load balancing of network traffic across multiple paths.

*   **Status:** **Disabled by default** (must be explicitly enabled)
*   **Scope:** Enabled **per DRG route table**
*   **Function:** Distributes traffic across **multiple equal-cost paths**

##### **ECMP Use Cases:**
*   **Multiple FastConnect Circuits:** Load balance across multiple dedicated connections
*   **Multiple IPSec Tunnels:** Distribute traffic across several VPN tunnels
*   **BGP-Based Load Sharing:** Automatic traffic distribution using BGP metrics

##### **ECMP Configuration:**
```
DRG Route Table → Enable ECMP → Load balance across multiple attachments
```

---

#### **4. Route Conflict Resolution**

When multiple routes conflict, OCI follows a **specific priority hierarchy**:

##### **A. Route Priority Hierarchy (Highest to Lowest):**
1.  **Static Routes** (manual configuration)
2.  **VCN Routes** (from VCN attachments)
3.  **Virtual Circuit Routes** (from FastConnect)
4.  **IPSec Tunnel Routes** (from Site-to-Site VPN)
5.  **Remote Peering Connection Routes** (from cross-region peering)

##### **B. Conflict Resolution Rules:**
*   **Static vs Dynamic:** **Static routes always win** over dynamic routes
*   **Dynamic vs Dynamic:** Resolved by **Autonomous System (AS) path**
*   **AS Path Characteristics:**
    *   **VCN/Static Routes:** AS path is **empty**
    *   **IPSec/Virtual Circuit:** AS path is **populated** with BGP information

---

#### **5. Default DRG Routing Behavior**

##### **A. Before Any Attachments:**
```
DRG Route Tables (2 auto-created):
├── Route Table for VCN Attachments: Empty (no static/dynamic routes)
└── Route Table for Other Attachments: Empty (no static/dynamic routes)
```

##### **B. After Attaching VCN and RPC:**
```
DRG Route Tables After Attachment:
├── Route Table for VCN Attachments:
│   ├── Static Routes: None (unless manually added)
│   └── Dynamic Routes: 
│       ├── VCN subnets (e.g., 10.0.1.0/24, 10.0.2.0/24)
│       └── Remote Peering Connection routes
└── Route Table for Other Attachments:
    ├── Static Routes: None (unless manually added)
    └── Dynamic Routes: 
        └── VCN subnets only (learns from VCN attachments)
```

##### **C. Key Default Behaviors:**
*   **VCN Route Table:** Learns routes from **ALL attachment types**
*   **Other Attachments Route Table:** Learns routes from **VCN attachments only**
*   **Automatic Route Learning:** Dynamic routes appear **without manual configuration**

---

#### **6. Practical Routing Examples**

##### **Example 1: Multi-Subnet VCN with RPC**
```
VCN Configuration:
- VCN CIDR: 10.0.0.0/16
- Subnet 1: 10.0.1.0/24
- Subnet 2: 10.0.2.0/24

DRG Routing Result:
├── VCN Route Table Dynamic Routes:
│   ├── 10.0.1.0/24 (local VCN)
│   ├── 10.0.2.0/24 (local VCN)
│   └── 192.168.0.0/16 (from RPC)
└── Other Attachments Route Table Dynamic Routes:
    ├── 10.0.1.0/24 (from VCN)
    └── 10.0.2.0/24 (from VCN)
```

##### **Example 2: Route Conflict Scenario**
```
Conflicting Routes:
- Static Route: 192.168.1.0/24 → IPSec Tunnel (manual)
- Dynamic Route: 192.168.1.0/24 → Virtual Circuit (BGP learned)

Resolution: 
Static route WINS due to higher priority
Traffic for 192.168.1.0/24 goes to IPSec Tunnel
```

---

#### **7. Custom Routing Configuration**

##### **A. Advanced Import Distribution:**
*   **Multiple Statements:** Create prioritized match criteria
*   **Selective Import:** Import specific routes from specific attachments
*   **Granular Control:** Fine-tuned route learning policies

##### **B. Custom Route Tables:**
*   **Per-Attachment Tables:** Assign dedicated route tables to each attachment
*   **Policy-Based Routing:** Different routing policies for different attachment types
*   **Environment Segregation:** Separate routing for production vs development

---

#### **Key DRG Routing Principles**

*   **Import Controls Learning:** Import distributions manage what routes are learned
*   **Export Controls Advertising:** Export distributions manage what routes are shared
*   **Static Over Dynamic:** Manual routes always override automatic routes
*   **ECMP Enables Load Balancing:** Multiple paths for redundancy and performance
*   **Default Behavior Exists:** Understand what happens automatically vs what requires configuration
*   **Customization Available:** Default behavior can be overridden with custom configurations


### **Study Notes: OCI Dynamic Routing Gateway (DRG) - Comprehensive Summary**

---

#### **1. DRG Core Concept**

A **Dynamic Routing Gateway (DRG)** is a **virtual router** that enables sophisticated network connectivity and routing between various network types.

*   **Primary Function:** Facilitates communication between **on-premises networks** and **Virtual Cloud Networks (VCNs)**
*   **Routing Hub:** Acts as central routing point for multiple network attachments
*   **Virtual Appliance:** Fully managed OCI service requiring no manual maintenance

---

#### **2. DRG Attachment Types**

A DRG supports **five types of network attachments**:

##### **A. VCN Attachments:**
*   Connects to **Virtual Cloud Networks**
*   Supports VCNs in **same or different tenancies**
*   Enables VCN-to-VCN routing

##### **B. Remote Peering Connections (RPC):**
*   Enables **cross-region VCN connectivity**
*   Connects to DRGs in other OCI regions

##### **C. IPsec Tunnel Attachments:**
*   **Site-to-Site VPN** connections
*   Encrypted tunnels over public internet

##### **D. Virtual Circuit Attachments:**
*   **FastConnect** dedicated connections
*   High-speed private connectivity

##### **E. Loopback Attachments:**
*   **Internal DRG routing** between different attachment types
*   Advanced traffic engineering scenarios

---

#### **3. DRG Route Tables and Distributions**

##### **A. Default Route Tables (Auto-Created):**
1.  **Route Table for VCN Attachments**
2.  **Route Table for All Other Attachments**

##### **B. Route Types:**
*   **Static Routes:** Manually configured routes
*   **Dynamic Routes:** Automatically learned via import distributions

##### **C. Custom Configuration:**
*   Create **custom DRG route tables**
*   Assign specific route tables to network resources
*   Override default routing behavior

---

#### **4. Equal Cost Multi-Path Routing (ECMP)**

*   **Function:** **Load balancing** across multiple network paths
*   **Use Cases:** Multiple FastConnect circuits, multiple IPsec tunnels
*   **Configuration:** Enabled per DRG route table
*   **Benefit:** Improved performance and redundancy

---

#### **5. DRG Routing Engine Operation**

##### **Packet Processing Flow:**
```
1. Packet arrives at DRG from ingress attachment
2. Route lookup performed on attachment's assigned route table
3. DRG routing engine determines next hop
4. Packet forwarded based on route table parameters
```

##### **Key Routing Decisions:**
*   **Ingress-Based:** Routing decision based on **which attachment** packet enters through
*   **Table-Associated:** Each attachment has **specific route table**
*   **Policy-Controlled:** Import/export distributions manage route learning/advertising

---

#### **6. DRG Use Cases and Benefits**

##### **A. Simplified Configuration:**
*   **Single DRG** can connect **multiple VCNs**
*   **Cross-tenancy** VCN attachments supported
*   **Eliminates need** for multiple local peering gateways

##### **B. High Availability:**
*   **Cross-region connectivity** via FastConnect
*   **Multi-path routing** for redundancy
*   **Automatic failover** capabilities

##### **C. Increased Scale:**
*   **300 VCN attachments** per single DRG
*   **Enterprise-grade** scalability
*   **Large infrastructure** support

##### **D. Transit Routing:**
*   **Hub-and-spoke architectures**
*   **Centralized traffic management**
*   **Transit VCN** designs

##### **E. Complex Routing:**
*   **Unique route tables** per attached network
*   **Advanced import/export policies**
*   **Network Virtual Appliance** integration
*   **Traffic inspection and filtering**

---

#### **7. Advanced Architecture Patterns**

##### **A. Hub-and-Spoke Topology:**
```
Hub VCN (with NVA) → DRG → Multiple Spoke VCNs
```
*   **Centralized security** enforcement
*   **Traffic inspection** at hub
*   **Simplified management**

##### **B. Cross-Tenancy Connectivity:**
```
Tenancy A VCN → DRG → Tenancy B VCN
```
*   **Inter-organization** connectivity
*   **Controlled route exchange**
*   **Security policy enforcement**

##### **C Multi-Region Hub:**
```
Region 1 VCNs → DRG → RPC → DRG → Region 2 VCNs
```
*   **Global network fabric**
*   **Cross-region disaster recovery**
*   **Geographic load distribution**

---

#### **8. Practical Implementation Benefits**

##### **A. Operational Efficiency:**
*   **Single management point** for multiple connections
*   **Unified routing policies** across hybrid environment
*   **Reduced configuration complexity**

##### **B. Security Enhancement:**
*   **Centralized security controls**
*   **Traffic segmentation** between attachments
*   **Network Virtual Appliance** integration for advanced security

##### **C. Cost Optimization:**
*   **Reduced resource overhead** compared to multiple LPGs
*   **Efficient bandwidth utilization** with ECMP
*   **Simplified network architecture** maintenance

---

#### **Key DRG Advantages Summary**

*   **Unified Connectivity:** Single gateway for all external and internal connections
*   **Advanced Routing:** Sophisticated routing policies and traffic engineering
*   **Enterprise Scale:** Support for large, complex network architectures
*   **Flexible Architecture:** Hub-and-spoke, full-mesh, and custom topologies
*   **Cross-Tenancy:** Connectivity between different OCI tenancies
*   **Hybrid Ready:** Seamless integration with on-premises networks



**Remember:** The DRG is OCI's **enterprise-grade routing solution** that enables complex network architectures, sophisticated traffic engineering, and seamless hybrid connectivity. It serves as the foundation for building scalable, secure, and highly available network infrastructures in Oracle Cloud.

**Remember:** DRG routing provides **sophisticated traffic engineering capabilities** for complex network architectures. Understanding import/export distributions, ECMP, and route conflict resolution is essential for designing robust, high-performance hybrid connectivity solutions in OCI.

**Remember:** The DRG acts as a **sophisticated traffic director** between your various network connections. Understanding the distinction between VCN route tables (internal routing) and DRG route tables (external routing) is crucial for designing effective network architectures in OCI.

**Remember:** The DRG is OCI's **advanced routing engine** that enables sophisticated network architectures. Understanding the relationship between DRG route tables and route distributions is crucial for designing effective hybrid and multi-VCN connectivity solutions.